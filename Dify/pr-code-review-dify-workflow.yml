app:
  description: GitHub REST APIã‚’ä½¿ç”¨ã—ã¦PRã®å·®åˆ†æƒ…å ±ã‚’å–å¾—ã—ã€ãƒ•ã‚¡ã‚¤ãƒ«æ¯ã«Azure OpenAIã§ã‚³ãƒ¼ãƒ‰ãƒ¬ãƒ“ãƒ¥ãƒ¼ã‚’è¡Œã†ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼
  icon: ğŸ¤–
  icon_background: '#FFEAD5'
  mode: workflow
  name: GitHub PR Code Review (HTTPç‰ˆ)
  use_icon_as_answer_icon: false
dependencies:
- current_identifier: null
  type: marketplace
  value:
    marketplace_plugin_unique_identifier: langgenius/openai:0.2.7@9031bbf9b37d9f6341a20c78a8bd18d686afd3ff627545496c3557705419d084
    version: null
kind: app
version: 0.5.0
workflow:
  conversation_variables: []
  environment_variables:
  - description: ''
    id: de9e5b25-d4fd-46f6-bcb8-1f0b18a53c1b
    name: GITHUB_TOKEN
    selector:
    - env
    - GITHUB_TOKEN
    value: ''
    value_type: secret
  features:
    file_upload:
      allowed_file_extensions:
      - .JPG
      - .JPEG
      - .PNG
      - .GIF
      - .WEBP
      - .SVG
      allowed_file_types:
      - image
      allowed_file_upload_methods:
      - local_file
      - remote_url
      enabled: false
      fileUploadConfig:
        audio_file_size_limit: 50
        batch_count_limit: 5
        file_size_limit: 15
        image_file_batch_limit: 10
        image_file_size_limit: 10
        single_chunk_attachment_limit: 10
        video_file_size_limit: 100
        workflow_file_upload_limit: 10
      image:
        enabled: false
        number_limits: 3
        transfer_methods:
        - local_file
        - remote_url
      number_limits: 3
    opening_statement: ''
    retriever_resource:
      enabled: true
    sensitive_word_avoidance:
      enabled: false
    speech_to_text:
      enabled: false
    suggested_questions: []
    suggested_questions_after_answer:
      enabled: false
    text_to_speech:
      enabled: false
      language: ''
      voice: ''
  graph:
    edges:
    - data:
        isInLoop: false
        sourceType: start
        targetType: http-request
      id: 1765864810321-source-1765865413274-target
      selected: false
      source: '1765864810321'
      sourceHandle: source
      target: '1765865413274'
      targetHandle: target
      type: custom
      zIndex: 0
    - data:
        isInLoop: false
        sourceType: http-request
        targetType: code
      id: 17658657034440-source-1765865834591-target
      selected: false
      source: '17658657034440'
      sourceHandle: source
      target: '1765865834591'
      targetHandle: target
      type: custom
      zIndex: 0
    - data:
        isInLoop: false
        sourceType: code
        targetType: llm
      id: 1765865834591-source-1765866652109-target
      selected: false
      source: '1765865834591'
      sourceHandle: source
      target: '1765866652109'
      targetHandle: target
      type: custom
      zIndex: 0
    - data:
        isInLoop: false
        sourceType: llm
        targetType: end
      id: 1765866652109-source-1765866969379-target
      selected: false
      source: '1765866652109'
      sourceHandle: source
      target: '1765866969379'
      targetHandle: target
      type: custom
      zIndex: 0
    - data:
        isInLoop: false
        sourceType: http-request
        targetType: http-request
      id: 1765865413274-source-17658656443830-target
      selected: false
      source: '1765865413274'
      sourceHandle: source
      target: '17658656443830'
      targetHandle: target
      type: custom
      zIndex: 0
    - data:
        isInLoop: false
        sourceType: http-request
        targetType: http-request
      id: 17658656443830-source-17658657034440-target
      selected: false
      source: '17658656443830'
      sourceHandle: source
      target: '17658657034440'
      targetHandle: target
      type: custom
      zIndex: 0
    nodes:
    - data:
        selected: false
        title: é–‹å§‹
        type: start
        variables:
        - default: ''
          hint: ''
          label: ãƒªãƒã‚¸ãƒˆãƒªã‚ªãƒ¼ãƒŠãƒ¼
          max_length: 100
          options: []
          placeholder: ''
          required: true
          type: text-input
          variable: owner
        - default: ''
          hint: ''
          label: ãƒªãƒã‚¸ãƒˆãƒªå
          max_length: 100
          options: []
          placeholder: ''
          required: true
          type: text-input
          variable: repo
        - default: ''
          hint: ''
          label: PRç•ªå·
          max_length: 10
          options: []
          placeholder: ''
          required: true
          type: text-input
          variable: pr_number
        - default: ''
          hint: ''
          label: PRã‚¿ã‚¤ãƒˆãƒ«
          max_length: 500
          options: []
          placeholder: ''
          required: false
          type: paragraph
          variable: pr_title
        - default: ''
          hint: ''
          label: PRèª¬æ˜
          max_length: 10000
          options: []
          placeholder: ''
          required: false
          type: paragraph
          variable: pr_body
        - default: ''
          hint: ''
          label: PR URL
          max_length: 500
          options: []
          placeholder: ''
          required: false
          type: paragraph
          variable: pr_url
        - default: ''
          hint: ''
          label: Head SHA
          max_length: 50
          options: []
          placeholder: ''
          required: false
          type: text-input
          variable: head_sha
        - default: ''
          hint: ''
          label: Base SHA
          max_length: 50
          options: []
          placeholder: ''
          required: false
          type: text-input
          variable: base_sha
        - default: ''
          hint: ''
          label: ãƒ•ã‚¡ã‚¤ãƒ«ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿JSON
          max_length: 500000
          options: []
          placeholder: ''
          required: true
          type: paragraph
          variable: files_meta_json
      height: 315
      id: '1765864810321'
      position:
        x: 0
        y: 0
      positionAbsolute:
        x: 0
        y: 0
      selected: true
      sourcePosition: right
      targetPosition: left
      type: custom
      width: 242
    - data:
        authorization:
          config: null
          type: no-auth
        body:
          data: []
          type: none
        desc: GitHub REST APIã§PRã®å¤‰æ›´ãƒ•ã‚¡ã‚¤ãƒ«ï¼ˆpatchå«ã‚€ï¼‰ã‚’å–å¾—
        headers: 'Authorization:Bearer {{#env.GITHUB_TOKEN#}}

          Accept:application/vnd.github.v3+json

          X-GitHub-Api-Version:2022-11-28'
        method: get
        params: ''
        retry_config:
          max_retries: 3
          retry_enabled: true
          retry_interval: 100
        selected: false
        ssl_verify: true
        timeout:
          connect: 10
          max_connect_timeout: 0
          max_read_timeout: 0
          max_write_timeout: 0
          read: 60
          write: 30
        title: PRå·®åˆ†å–å¾—
        type: http-request
        url: https://api.github.com/repos/{{#1765864810321.owner#}}/{{#1765864810321.repo#}}/pulls/{{#1765864810321.pr_number#}}/files?per_page=100
        variables: []
      height: 235
      id: '1765865413274'
      position:
        x: 342
        y: 48
      positionAbsolute:
        x: 342
        y: 48
      selected: true
      sourcePosition: right
      targetPosition: left
      type: custom
      width: 241
    - data:
        authorization:
          config: null
          type: no-auth
        body:
          data: []
          type: none
        desc: GitHub REST APIã§PRã®å¤‰æ›´ãƒ•ã‚¡ã‚¤ãƒ«ï¼ˆpatchå«ã‚€ï¼‰ã‚’å–å¾—
        headers: 'Authorization:Bearer {{#env.GITHUB_TOKEN#}}

          Accept:application/vnd.github.v3+json

          X-GitHub-Api-Version:2022-11-28'
        method: get
        params: ''
        retry_config:
          max_retries: 3
          retry_enabled: true
          retry_interval: 100
        selected: false
        ssl_verify: true
        timeout:
          connect: 10
          max_connect_timeout: 0
          max_read_timeout: 0
          max_write_timeout: 0
          read: 60
          write: 30
        title: PRå·®åˆ†å–å¾— (page=2)
        type: http-request
        url: https://api.github.com/repos/{{#1765864810321.owner#}}/{{#1765864810321.repo#}}/pulls/{{#1765864810321.pr_number#}}/files?per_page=100&page=2
        variables: []
      height: 235
      id: '17658656443830'
      position:
        x: 683
        y: 48
      positionAbsolute:
        x: 683
        y: 48
      selected: true
      sourcePosition: right
      targetPosition: left
      type: custom
      width: 241
    - data:
        authorization:
          config: null
          type: no-auth
        body:
          data: []
          type: none
        desc: GitHub REST APIã§PRã®å¤‰æ›´ãƒ•ã‚¡ã‚¤ãƒ«ï¼ˆpatchå«ã‚€ï¼‰ã‚’å–å¾—
        headers: 'Authorization:Bearer {{#env.GITHUB_TOKEN#}}

          Accept:application/vnd.github.v3+json

          X-GitHub-Api-Version:2022-11-28'
        method: get
        params: ''
        retry_config:
          max_retries: 3
          retry_enabled: true
          retry_interval: 100
        selected: false
        ssl_verify: true
        timeout:
          connect: 10
          max_connect_timeout: 0
          max_read_timeout: 0
          max_write_timeout: 0
          read: 60
          write: 30
        title: PRå·®åˆ†å–å¾— (page=3)
        type: http-request
        url: https://api.github.com/repos/{{#1765864810321.owner#}}/{{#1765864810321.repo#}}/pulls/{{#1765864810321.pr_number#}}/files?per_page=100&page=3
        variables: []
      height: 235
      id: '17658657034440'
      position:
        x: 1024
        y: 48
      positionAbsolute:
        x: 1024
        y: 48
      selected: true
      sourcePosition: right
      targetPosition: left
      type: custom
      width: 241
    - data:
        code: "import json\nfrom typing import Any\nimport re\n\ndef get_file_priority(filename:\
          \ str, status: str) -> tuple:\n    \"\"\"\n    ãƒ•ã‚¡ã‚¤ãƒ«ã®å„ªå…ˆåº¦ã‚’è¨ˆç®—ã™ã‚‹ï¼ˆWebã‚µã‚¤ãƒˆé–‹ç™ºå‘ã‘ï¼‰ã€‚\n\
          \    æˆ»ã‚Šå€¤: (priority_group, sub_priority)\n    - priority_groupãŒå°ã•ã„ã»ã©å„ªå…ˆåº¦ãŒé«˜ã„\n\
          \    - åŒä¸€ã‚°ãƒ«ãƒ¼ãƒ—å†…ã§ã¯sub_priorityã§ã‚½ãƒ¼ãƒˆ\n    \"\"\"\n    # å‰Šé™¤ãƒ•ã‚¡ã‚¤ãƒ«ã¯æœ€ä½å„ªå…ˆåº¦\n    if\
          \ status == \"removed\":\n        return (99, 0)\n    \n    # æ‹¡å¼µå­ã‚’å–å¾—\n \
          \   ext = filename.rsplit('.', 1)[-1].lower() if '.' in filename else ''\n\
          \    basename = filename.rsplit('/', 1)[-1].lower()\n    path_lower = filename.lower()\n\
          \    \n    # ãƒ†ã‚¹ãƒˆåˆ¤å®šç”¨\n    is_test = ('test' in basename or 'spec' in basename\
          \ or \n              '_test.' in path_lower or '.test.' in path_lower or\n\
          \              '/test/' in path_lower or '/tests/' in path_lower or\n  \
          \            '/__tests__/' in path_lower)\n    \n    # ã‚°ãƒ«ãƒ¼ãƒ—1: ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆãƒ»ãƒšãƒ¼ã‚¸ï¼ˆæœ€å„ªå…ˆï¼‰\n\
          \    frontend_exts = {'tsx', 'jsx', 'vue', 'svelte'}\n    if ext in frontend_exts:\n\
          \        if is_test:\n            return (5, 0)\n        # ãƒšãƒ¼ã‚¸ãƒ»ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆã¯ç‰¹ã«é‡è¦\n\
          \        if '/pages/' in path_lower or '/app/' in path_lower or '/layouts/'\
          \ in path_lower:\n            return (1, 0)\n        # ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ\n       \
          \ if '/components/' in path_lower:\n            return (1, 1)\n        return\
          \ (1, 2)\n    \n    # ã‚°ãƒ«ãƒ¼ãƒ—2: JavaScript/TypeScriptï¼ˆãƒ­ã‚¸ãƒƒã‚¯ãƒ»ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£ï¼‰\n    js_exts\
          \ = {'ts', 'js', 'mjs', 'cjs'}\n    if ext in js_exts:\n        if is_test:\n\
          \            return (5, 0)\n        # APIãƒ»ã‚µãƒ¼ãƒãƒ¼ã‚µã‚¤ãƒ‰\n        if '/api/' in\
          \ path_lower or '/server/' in path_lower:\n            return (2, 0)\n \
          \       # ãƒ•ãƒƒã‚¯ãƒ»ã‚¹ãƒˆã‚¢ãƒ»ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£\n        if '/hooks/' in path_lower or '/store/'\
          \ in path_lower or '/utils/' in path_lower or '/lib/' in path_lower:\n \
          \           return (2, 1)\n        return (2, 2)\n    \n    # ã‚°ãƒ«ãƒ¼ãƒ—3: ã‚¹ã‚¿ã‚¤ãƒ«ã‚·ãƒ¼ãƒˆï¼ˆWebã‚µã‚¤ãƒˆã§ã¯é‡è¦ï¼‰\n\
          \    style_exts = {'css', 'scss', 'sass', 'less', 'styl'}\n    if ext in\
          \ style_exts:\n        # ã‚°ãƒ­ãƒ¼ãƒãƒ«ã‚¹ã‚¿ã‚¤ãƒ«ã¯é‡è¦\n        if 'global' in basename or\
          \ 'main' in basename or 'app' in basename or 'index' in basename:\n    \
          \        return (3, 0)\n        return (3, 1)\n    \n    # ã‚°ãƒ«ãƒ¼ãƒ—4: HTMLãƒ»ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆ\n\
          \    template_exts = {'html', 'htm', 'ejs', 'hbs', 'pug', 'njk', 'twig'}\n\
          \    if ext in template_exts:\n        return (4, 0)\n    \n    # ã‚°ãƒ«ãƒ¼ãƒ—5:\
          \ ãƒ†ã‚¹ãƒˆãƒ•ã‚¡ã‚¤ãƒ«\n    if is_test:\n        return (5, 0)\n    \n    # ã‚°ãƒ«ãƒ¼ãƒ—6: è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«\n\
          \    config_patterns = [\n        'package.json', 'package-lock.json', 'yarn.lock',\
          \ 'pnpm-lock.yaml',\n        'tsconfig', 'jsconfig', 'vite.config', 'next.config',\
          \ 'nuxt.config',\n        'webpack.config', 'rollup.config', 'esbuild',\
          \ 'babel.config',\n        'tailwind.config', 'postcss.config', 'eslint',\
          \ 'prettier',\n        '.env', 'vercel.json', 'netlify.toml'\n    ]\n  \
          \  config_exts = {'json', 'yml', 'yaml', 'toml', 'js', 'ts', 'mjs', 'cjs'}\n\
          \    if any(p in basename for p in config_patterns):\n        # package.jsonã¯ç‰¹ã«é‡è¦\n\
          \        if basename == 'package.json':\n            return (6, 0)\n   \
          \     return (6, 1)\n    if ext in config_exts and ('config' in basename\
          \ or 'rc' in basename):\n        return (6, 2)\n    \n    # ã‚°ãƒ«ãƒ¼ãƒ—7: ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ\n\
          \    doc_exts = {'md', 'mdx', 'txt', 'rst'}\n    if ext in doc_exts:\n \
          \       if basename == 'readme.md':\n            return (7, 0)\n       \
          \ return (7, 1)\n    \n    # ã‚°ãƒ«ãƒ¼ãƒ—8: ç”»åƒãƒ»ã‚¢ã‚»ãƒƒãƒˆ\n    asset_exts = {'svg', 'png',\
          \ 'jpg', 'jpeg', 'gif', 'webp', 'ico', 'avif'}\n    font_exts = {'woff',\
          \ 'woff2', 'ttf', 'eot', 'otf'}\n    if ext in asset_exts:\n        # SVGã¯ã‚³ãƒ¼ãƒ‰ã¨ã—ã¦æ‰±ã†ã“ã¨ã‚‚å¤šã„\n\
          \        if ext == 'svg':\n            return (8, 0)\n        return (8,\
          \ 1)\n    if ext in font_exts:\n        return (8, 2)\n    \n    # ã‚°ãƒ«ãƒ¼ãƒ—9:\
          \ ã‚¤ãƒ³ãƒ•ãƒ©ãƒ»CI/CD\n    infra_patterns = ['dockerfile', 'docker-compose', '.github/',\
          \ 'jenkinsfile', '.gitlab-ci']\n    if any(p in path_lower for p in infra_patterns):\n\
          \        return (9, 0)\n    \n    # ãã®ä»–\n    return (10, 0)\n\ndef main(\n\
          \    files_meta_json: str,\n    pr_files_response: str,\n    pr_files_response_p2:\
          \ str,\n    pr_files_response_p3: str,\n    pr_title: str,\n    pr_body:\
          \ str,\n    pr_url: str,\n    owner: str,\n    repo: str,\n    pr_number:\
          \ str\n) -> dict[str, Any]:\n    \"\"\"\n    GitHub Actionsã®ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿ã¨patchæƒ…å ±ã‚’çµ±åˆã—ã¦ãƒ¬ãƒ“ãƒ¥ãƒ¼ç”¨ãƒ‡ãƒ¼ã‚¿ã‚’ä½œæˆã€‚\n\
          \    ãƒ•ã‚¡ã‚¤ãƒ«ã‚’å„ªå…ˆåº¦ã§ã‚½ãƒ¼ãƒˆã—ã€å„ãƒ•ã‚¡ã‚¤ãƒ«ã‚’å‡ç­‰ã«ãƒˆãƒ©ãƒ³ã‚±ãƒ¼ãƒˆã—ã¦\n    æ¼ã‚Œãªããƒ¬ãƒ“ãƒ¥ãƒ¼ã§ãã‚‹ã‚ˆã†ã«ã™ã‚‹ã€‚\n    \"\"\"\n\
          \    # è¨­å®šå€¤\n    MAX_DETAILED_FILES = 50      # è©³ç´°patchä»˜ãã§è¡¨ç¤ºã™ã‚‹ãƒ•ã‚¡ã‚¤ãƒ«æ•°\n   \
          \ MAX_PATCH_PER_FILE = 4000    # ãƒ•ã‚¡ã‚¤ãƒ«ã‚ãŸã‚Šã®æœ€å¤§patchæ–‡å­—æ•°\n    MAX_TOTAL_CHARS\
          \ = 120000     # åˆè¨ˆæœ€å¤§æ–‡å­—æ•°ï¼ˆLLMã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆåˆ¶é™å¯¾ç­–ï¼‰\n    \n    try:\n        # GitHub\
          \ Actionsã‹ã‚‰ã®ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿ã‚’ãƒ‘ãƒ¼ã‚¹\n        files_meta = json.loads(files_meta_json)\
          \ if files_meta_json else []\n        \n        # GitHub APIãƒ¬ã‚¹ãƒãƒ³ã‚¹ï¼ˆpatchå«ã‚€ï¼‰ã‚’ãƒ‘ãƒ¼ã‚¹\n\
          \        pr_files = []\n        for _resp in [pr_files_response, pr_files_response_p2,\
          \ pr_files_response_p3]:\n            if _resp:\n                pr_files.extend(json.loads(_resp))\n\
          \        \n        # ãƒ•ã‚¡ã‚¤ãƒ«åã‚’ã‚­ãƒ¼ã«ã—ãŸpatchãƒãƒƒãƒ—ã‚’ä½œæˆ\n        patch_map = {}\n  \
          \      for f in pr_files:\n            if isinstance(f, dict):\n       \
          \         filename = f.get(\"filename\", \"\")\n                patch =\
          \ f.get(\"patch\", \"\")\n                patch_map[filename] = patch\n\
          \        \n        # çµ±è¨ˆæƒ…å ±ã‚’è¨ˆç®—\n        total_additions = 0\n        total_deletions\
          \ = 0\n        total_changes = 0\n        \n        # ãƒ•ã‚¡ã‚¤ãƒ«ã”ã¨ã®è©³ç´°æƒ…å ±ã‚’æ§‹ç¯‰\n \
          \       file_details = []\n        for f in files_meta:\n            if\
          \ not isinstance(f, dict):\n                continue\n            \n   \
          \         filename = f.get(\"filename\", \"unknown\")\n            status\
          \ = f.get(\"status\", \"unknown\")\n            additions = f.get(\"additions\"\
          , 0)\n            deletions = f.get(\"deletions\", 0)\n            changes\
          \ = f.get(\"changes\", 0)\n            previous_filename = f.get(\"previous_filename\"\
          )\n            \n            total_additions += additions\n            total_deletions\
          \ += deletions\n            total_changes += changes\n            \n   \
          \         # patchã‚’å–å¾—\n            patch = patch_map.get(filename, \"\")\n\
          \            \n            # å„ªå…ˆåº¦ã‚’è¨ˆç®—\n            priority = get_file_priority(filename,\
          \ status)\n            \n            file_details.append({\n           \
          \     \"filename\": filename,\n                \"status\": status,\n   \
          \             \"additions\": additions,\n                \"deletions\":\
          \ deletions,\n                \"changes\": changes,\n                \"\
          previous_filename\": previous_filename,\n                \"patch\": patch,\n\
          \                \"priority\": priority,\n                \"has_patch\"\
          : bool(patch)\n            })\n        \n        # å„ªå…ˆåº¦ã§ã‚½ãƒ¼ãƒˆï¼ˆå„ªå…ˆåº¦ãŒä½ã„æ•°å€¤ = é«˜å„ªå…ˆåº¦ï¼‰\n\
          \        file_details.sort(key=lambda x: (x[\"priority\"], -x[\"changes\"\
          ]))\n        \n        # ãƒ¬ãƒ“ãƒ¥ãƒ¼ç”¨ã®ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆæ¸ˆã¿ãƒ†ã‚­ã‚¹ãƒˆã‚’ç”Ÿæˆ\n        output_lines = []\n\
          \        current_chars = 0\n        \n        # PRåŸºæœ¬æƒ…å ±\n        output_lines.append(\"\
          ## Pull Request æƒ…å ±\")\n        output_lines.append(f\"- **ã‚¿ã‚¤ãƒˆãƒ«**: {pr_title\
          \ or '(ãªã—)'}\")\n        output_lines.append(f\"- **ãƒªãƒã‚¸ãƒˆãƒª**: {owner}/{repo}\"\
          )\n        output_lines.append(f\"- **PRç•ªå·**: #{pr_number}\")\n        if\
          \ pr_url:\n            output_lines.append(f\"- **URL**: {pr_url}\")\n \
          \       output_lines.append(f\"- **å¤‰æ›´ãƒ•ã‚¡ã‚¤ãƒ«æ•°**: {len(file_details)}\")\n \
          \       output_lines.append(f\"- **è¿½åŠ è¡Œæ•°**: +{total_additions}\")\n     \
          \   output_lines.append(f\"- **å‰Šé™¤è¡Œæ•°**: -{total_deletions}\")\n        \n\
          \        # PRèª¬æ˜\n        if pr_body:\n            truncated_body = pr_body[:1000]\n\
          \            if len(pr_body) > 1000:\n                truncated_body +=\
          \ \"... (truncated)\"\n            output_lines.append(f\"\\n### PRèª¬æ˜\\\
          n{truncated_body}\")\n        \n        current_chars = sum(len(line) for\
          \ line in output_lines)\n        \n        # ãƒ•ã‚¡ã‚¤ãƒ«è©³ç´°ã‚»ã‚¯ã‚·ãƒ§ãƒ³\n        output_lines.append(\"\
          \\n## å¤‰æ›´ãƒ•ã‚¡ã‚¤ãƒ«è©³ç´°\")\n        output_lines.append(f\"ï¼ˆå„ªå…ˆåº¦é †ã«{min(MAX_DETAILED_FILES,\
          \ len(file_details))}ä»¶ã‚’è©³ç´°è¡¨ç¤ºï¼‰\\n\")\n        \n        # ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹çµµæ–‡å­—ãƒãƒƒãƒ”ãƒ³ã‚°\n\
          \        status_emoji = {\n            \"added\": \"\U0001F195\",\n    \
          \        \"modified\": \"\U0001F4DD\",\n            \"renamed\": \"\U0001F4DB\
          \",\n            \"removed\": \"\U0001F5D1ï¸\",\n            \"copied\":\
          \ \"\U0001F4CB\"\n        }\n        \n        # è©³ç´°è¡¨ç¤ºã™ã‚‹ãƒ•ã‚¡ã‚¤ãƒ«\n        detailed_files\
          \ = []\n        summary_files = []\n        truncated_files = []\n     \
          \   \n        for i, f in enumerate(file_details):\n            if i < MAX_DETAILED_FILES\
          \ and current_chars < MAX_TOTAL_CHARS:\n                emoji = status_emoji.get(f[\"\
          status\"], \"\U0001F4C4\")\n                file_section = []\n        \
          \        file_section.append(f\"\\n### {emoji} {f['filename']}\")\n    \
          \            file_section.append(f\"å¤‰æ›´: +{f['additions']} / -{f['deletions']}\
          \ | ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹: {f['status']}\")\n                \n                if f[\"previous_filename\"\
          ]:\n                    file_section.append(f\"å…ƒãƒ•ã‚¡ã‚¤ãƒ«å: {f['previous_filename']}\"\
          )\n                \n                if f[\"patch\"] and f[\"status\"] !=\
          \ \"removed\":\n                    patch = f[\"patch\"]\n             \
          \       was_truncated = False\n                    if len(patch) > MAX_PATCH_PER_FILE:\n\
          \                        patch = patch[:MAX_PATCH_PER_FILE]\n          \
          \              was_truncated = True\n                        truncated_files.append(f[\"\
          filename\"])\n                    \n                    file_section.append(f\"\
          \\n```diff\\n{patch}\")\n                    if was_truncated:\n       \
          \                 file_section.append(f\"... (æ®‹ã‚Š{len(f['patch']) - MAX_PATCH_PER_FILE}æ–‡å­—çœç•¥)\"\
          )\n                    file_section.append(\"```\")\n                elif\
          \ f[\"status\"] == \"removed\":\n                    file_section.append(\"\
          (ãƒ•ã‚¡ã‚¤ãƒ«å‰Šé™¤)\")\n                elif not f[\"has_patch\"]:\n              \
          \      file_section.append(\"(ãƒ‘ãƒƒãƒæƒ…å ±ãªã— - ãƒã‚¤ãƒŠãƒªãƒ•ã‚¡ã‚¤ãƒ«ã¾ãŸã¯å¤§ãã™ãã‚‹ãƒ•ã‚¡ã‚¤ãƒ«)\")\n     \
          \           \n                section_text = \"\\n\".join(file_section)\n\
          \                section_chars = len(section_text)\n                \n \
          \               # æ–‡å­—æ•°åˆ¶é™ãƒã‚§ãƒƒã‚¯\n                if current_chars + section_chars\
          \ < MAX_TOTAL_CHARS:\n                    output_lines.append(section_text)\n\
          \                    current_chars += section_chars\n                  \
          \  detailed_files.append(f[\"filename\"])\n                else:\n     \
          \               summary_files.append(f)\n            else:\n           \
          \     summary_files.append(f)\n        \n        # ã‚µãƒãƒªãƒ¼è¡¨ç¤ºï¼ˆè©³ç´°è¡¨ç¤ºã§ããªã‹ã£ãŸãƒ•ã‚¡ã‚¤ãƒ«ï¼‰\n\
          \        if summary_files:\n            output_lines.append(f\"\\n## ãã®ä»–ã®å¤‰æ›´ãƒ•ã‚¡ã‚¤ãƒ«ï¼ˆ{len(summary_files)}ä»¶ï¼‰\"\
          )\n            output_lines.append(\"â€» ä»¥ä¸‹ã®ãƒ•ã‚¡ã‚¤ãƒ«ã¯å·®åˆ†ã®è©³ç´°è¡¨ç¤ºã‚’çœç•¥ã—ã¦ã„ã¾ã™\\n\")\n \
          \           \n            for f in summary_files:\n                emoji\
          \ = status_emoji.get(f[\"status\"], \"\U0001F4C4\")\n                output_lines.append(f\"\
          - {emoji} **{f['filename']}** (+{f['additions']}/-{f['deletions']})\")\n\
          \        \n        # ãƒˆãƒ©ãƒ³ã‚±ãƒ¼ãƒˆè­¦å‘Š\n        if truncated_files:\n           \
          \ output_lines.append(f\"\\n---\\nâš ï¸ **æ³¨æ„**: ä»¥ä¸‹ã®ãƒ•ã‚¡ã‚¤ãƒ«ã¯å·®åˆ†ãŒé•·ã„ãŸã‚ä¸€éƒ¨çœç•¥ã•ã‚Œã¦ã„ã¾ã™:\"\
          )\n            for tf in truncated_files[:10]:  # æœ€å¤§10ä»¶è¡¨ç¤º\n            \
          \    output_lines.append(f\"  - {tf}\")\n            if len(truncated_files)\
          \ > 10:\n                output_lines.append(f\"  - ä»– {len(truncated_files)\
          \ - 10} ä»¶\")\n        \n        result = \"\\n\".join(output_lines)\n  \
          \      \n        return {\n            \"result\": result,\n           \
          \ \"file_count\": len(file_details),\n            \"detailed_file_count\"\
          : len(detailed_files),\n            \"summary_file_count\": len(summary_files),\n\
          \            \"truncated_file_count\": len(truncated_files),\n         \
          \   \"total_additions\": total_additions,\n            \"total_deletions\"\
          : total_deletions,\n            \"total_changes\": total_changes,\n    \
          \        \"total_chars\": len(result),\n            \"has_changes\": len(file_details)\
          \ > 0\n        }\n        \n    except json.JSONDecodeError as e:\n    \
          \    return {\n            \"result\": f\"âš ï¸ JSONãƒ‘ãƒ¼ã‚¹ã‚¨ãƒ©ãƒ¼: {str(e)}\",\n \
          \           \"file_count\": 0,\n            \"detailed_file_count\": 0,\n\
          \            \"summary_file_count\": 0,\n            \"truncated_file_count\"\
          : 0,\n            \"total_additions\": 0,\n            \"total_deletions\"\
          : 0,\n            \"total_changes\": 0,\n            \"total_chars\": 0,\n\
          \            \"has_changes\": False\n        }\n    except Exception as\
          \ e:\n        return {\n            \"result\": f\"âš ï¸ ãƒ‡ãƒ¼ã‚¿æ•´å½¢ã‚¨ãƒ©ãƒ¼: {str(e)}\"\
          ,\n            \"file_count\": 0,\n            \"detailed_file_count\":\
          \ 0,\n            \"summary_file_count\": 0,\n            \"truncated_file_count\"\
          : 0,\n            \"total_additions\": 0,\n            \"total_deletions\"\
          : 0,\n            \"total_changes\": 0,\n            \"total_chars\": 0,\n\
          \            \"has_changes\": False\n        }"
        code_language: python3
        desc: ãƒ•ã‚¡ã‚¤ãƒ«ã‚’å„ªå…ˆåº¦ã§ã‚½ãƒ¼ãƒˆã—ã€æ¼ã‚Œãªããƒ¬ãƒ“ãƒ¥ãƒ¼ç”¨ãƒ‡ãƒ¼ã‚¿ã‚’ä½œæˆ
        outputs:
          detailed_file_count:
            children: null
            type: string
          file_count:
            children: null
            type: string
          has_changes:
            children: null
            type: string
          result:
            children: null
            type: string
          summary_file_count:
            children: null
            type: string
          total_additions:
            children: null
            type: string
          total_deletions:
            children: null
            type: string
          truncated_file_count:
            children: null
            type: string
        selected: false
        title: å·®åˆ†ãƒ‡ãƒ¼ã‚¿æ•´å½¢
        type: code
        variables:
        - value_selector:
          - '1765864810321'
          - files_meta_json
          value_type: string
          variable: files_meta_json
        - value_selector:
          - '1765865413274'
          - body
          value_type: string
          variable: pr_files_response
        - value_selector:
          - '17658656443830'
          - body
          value_type: string
          variable: pr_files_response_p2
        - value_selector:
          - '17658657034440'
          - body
          value_type: string
          variable: pr_files_response_p3
        - value_selector:
          - '1765864810321'
          - pr_title
          value_type: string
          variable: pr_title
        - value_selector:
          - '1765864810321'
          - pr_body
          value_type: string
          variable: pr_body
        - value_selector:
          - '1765864810321'
          - pr_url
          value_type: string
          variable: pr_url
        - value_selector:
          - '1765864810321'
          - owner
          value_type: string
          variable: owner
        - value_selector:
          - '1765864810321'
          - repo
          value_type: string
          variable: repo
        - value_selector:
          - '1765864810321'
          - pr_number
          value_type: string
          variable: pr_number
      height: 94
      id: '1765865834591'
      position:
        x: 1365
        y: 111
      positionAbsolute:
        x: 1365
        y: 111
      selected: true
      sourcePosition: right
      targetPosition: left
      type: custom
      width: 241
    - data:
        context:
          enabled: false
          variable_selector: []
        desc: Azure OpenAIã§ãƒ•ã‚¡ã‚¤ãƒ«æ¯ã«æ¼ã‚Œãªãã‚³ãƒ¼ãƒ‰ãƒ¬ãƒ“ãƒ¥ãƒ¼ã‚’å®Ÿæ–½
        model:
          completion_params:
            max_tokens: 4096
            temperature: 0.2
            top_p: 0.95
          mode: chat
          name: gpt-4
          provider: langgenius/openai/openai
        prompt_template:
        - id: 2a45abbc-e6ce-49ac-bd23-c9f331039c56
          role: system
          text: "ã‚ãªãŸã¯10å¹´ä»¥ä¸Šã®çµŒé¨“ã‚’æŒã¤ã‚·ãƒ‹ã‚¢ã‚½ãƒ•ãƒˆã‚¦ã‚§ã‚¢ã‚¨ãƒ³ã‚¸ãƒ‹ã‚¢ã§ã€ã‚³ãƒ¼ãƒ‰ãƒ¬ãƒ“ãƒ¥ãƒ¼ã®å°‚é–€å®¶ã§ã™ã€‚\nãƒãƒ¼ãƒ ã®ç”Ÿç”£æ€§å‘ä¸Šã¨ã‚³ãƒ¼ãƒ‰å“è³ªã®ç¶­æŒã‚’æœ€å„ªå…ˆã«è€ƒãˆã€å»ºè¨­çš„ã§å®Ÿç”¨çš„ãªãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯ã‚’æä¾›ã—ã¾ã™ã€‚\n\
            \n## ãƒ¬ãƒ“ãƒ¥ãƒ¼æ–¹é‡\n\n- **æ¼ã‚Œã®ãªã„ãƒ¬ãƒ“ãƒ¥ãƒ¼**: æç¤ºã•ã‚ŒãŸå…¨ã¦ã®ãƒ•ã‚¡ã‚¤ãƒ«ã«ã¤ã„ã¦ã‚³ãƒ¡ãƒ³ãƒˆã—ã¦ãã ã•ã„\n- é‡å¤§ãªãƒã‚°ã‚„è„†å¼±æ€§ã‚’æœ€å„ªå…ˆã§æŒ‡æ‘˜\n\
            - å˜ãªã‚‹ã‚¹ã‚¿ã‚¤ãƒ«ã®å¥½ã¿ã‚ˆã‚Šã€å®Ÿè³ªçš„ãªå“è³ªæ”¹å–„ã‚’é‡è¦–\n- è‰¯ã„ç‚¹ã‚‚ç©æ¥µçš„ã«èªã‚ã€ãƒ¢ãƒãƒ™ãƒ¼ã‚·ãƒ§ãƒ³ã‚’ç¶­æŒ\n- æŒ‡æ‘˜ã«ã¯å¿…ãšæ”¹å–„æ¡ˆã‚’æ·»ãˆã‚‹\n\
            \n## è©•ä¾¡è¦³ç‚¹ï¼ˆå„ªå…ˆåº¦é †ï¼‰\n\n### 1. å®‰å…¨æ€§ãƒ»ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ï¼ˆæœ€å„ªå…ˆï¼‰\n- SQLã‚¤ãƒ³ã‚¸ã‚§ã‚¯ã‚·ãƒ§ãƒ³ã€XSSã€CSRF\n- èªè¨¼ãƒ»èªå¯ã®å•é¡Œ\n\
            - æ©Ÿå¯†æƒ…å ±ã®æ¼æ´©ãƒªã‚¹ã‚¯ï¼ˆAPIã‚­ãƒ¼ã€ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ç­‰ï¼‰\n- å…¥åŠ›å€¤ã®æ¤œè¨¼ä¸è¶³\n\n### 2. ãƒã‚°ãƒ»ãƒ­ã‚¸ãƒƒã‚¯ã‚¨ãƒ©ãƒ¼\n- ã‚¨ãƒƒã‚¸ã‚±ãƒ¼ã‚¹ã®è€ƒæ…®æ¼ã‚Œ\n\
            - Off-by-oneã‚¨ãƒ©ãƒ¼\n- null/undefinedå‚ç…§\n- ä¾‹å¤–å‡¦ç†ã®ä¸å‚™\n- ç«¶åˆçŠ¶æ…‹ï¼ˆrace conditionï¼‰\n\
            \n### 3. ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹\n- N+1ã‚¯ã‚¨ãƒªå•é¡Œ\n- ä¸è¦ãªå†è¨ˆç®—ãƒ»å†ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°\n- ãƒ¡ãƒ¢ãƒªãƒªãƒ¼ã‚¯\n- éåŠ¹ç‡ãªã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ \n\
            \n### 4. ä¿å®ˆæ€§ãƒ»å¯èª­æ€§\n- å‘½åè¦å‰‡ã®ä¸€è²«æ€§\n- è¤‡é›‘åº¦ã®é«˜ã„å‡¦ç†ï¼ˆèªçŸ¥çš„è¤‡é›‘åº¦ï¼‰\n- ãƒã‚¸ãƒƒã‚¯ãƒŠãƒ³ãƒãƒ¼ãƒ»ãƒã‚¸ãƒƒã‚¯ã‚¹ãƒˆãƒªãƒ³ã‚°\n\
            - é©åˆ‡ãªã‚³ãƒ¡ãƒ³ãƒˆãƒ»ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ\n\n### 5. è¨­è¨ˆãƒ»ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£\n- è²¬å‹™ã®åˆ†é›¢ï¼ˆSRPï¼‰\n- DRYåŸå‰‡ã®éµå®ˆ\n- ãƒ†ã‚¹ã‚¿ãƒ“ãƒªãƒ†ã‚£\n\
            - ä¾å­˜é–¢ä¿‚ã®æ–¹å‘\n\n## å‡ºåŠ›ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆ\n\nå¿…ãšä»¥ä¸‹ã®å½¢å¼ã§æ—¥æœ¬èªã§å›ç­”ã—ã¦ãã ã•ã„ã€‚\n**é‡è¦**: æç¤ºã•ã‚ŒãŸå…¨ãƒ•ã‚¡ã‚¤ãƒ«ã«ã¤ã„ã¦ã‚³ãƒ¡ãƒ³ãƒˆã‚’å«ã‚ã¦ãã ã•ã„ã€‚\n\
            **æ³¨æ„**: ã‚¹ã‚³ã‚¢ã¯PRã®å†…å®¹ã«å¿œã˜ã¦1ã€œ5ã§ã‚ãªãŸè‡ªèº«ãŒåˆ¤æ–­ã—ã¦ãã ã•ã„ï¼ˆä¾‹ã®æ•°å€¤ã«å¼•ããšã‚‰ã‚Œãªã„ï¼‰ã€‚\n\n### \U0001F4CA\
            \ ç·åˆè©•ä¾¡\n\n**ã‚¹ã‚³ã‚¢**: 1ã€œ5/5ï¼ˆä¾‹: 4/5ï¼‰ã€‚å¿…è¦ã«å¿œã˜ã¦ â­ è¡¨è¨˜ã—ã¦ã‚ˆã„ï¼ˆä¾‹ã«å¼•ããšã‚‰ã‚Œãªã„ï¼‰\n\n**æ¦‚è¦**:\
            \ [1ã€œ2æ–‡ã§ã®å¤‰æ›´ã‚µãƒãƒªãƒ¼]\n\n**ãƒ¬ãƒ“ãƒ¥ãƒ¼åˆ¤å®š**: `APPROVE` / `REQUEST_CHANGES` / `COMMENT`\n\
            \n---\n\n### \U0001F534 é‡å¤§ãªæŒ‡æ‘˜ï¼ˆå¿…é ˆä¿®æ­£ï¼‰\n\n> é‡å¤§ãªã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£å•é¡Œã‚„ãƒã‚°ãŒã‚ã‚Œã°è¨˜è¼‰ã€‚ãªã‘ã‚Œã°ã€Œãªã—ã€\n\
            \n**ä¾‹:**\n- **[ãƒ•ã‚¡ã‚¤ãƒ«å:è¡Œç•ªå·]** å•é¡Œã®èª¬æ˜\n```è¨€èª\n  ä¿®æ­£æ¡ˆã®ã‚³ãƒ¼ãƒ‰\n```\n\n---\n\n###\
            \ \U0001F7E1 æ”¹å–„æ¨å¥¨\n\n> ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ã‚„ä¿å®ˆæ€§ã«é–¢ã™ã‚‹æŒ‡æ‘˜\n\n---\n\n### \U0001F7E2 è»½å¾®ãªææ¡ˆ\n\
            \n> ã‚³ãƒ¼ãƒ‰ã‚¹ã‚¿ã‚¤ãƒ«ã‚„å‘½åã«é–¢ã™ã‚‹ææ¡ˆ\n\n---\n\n### \U0001F4C1 ãƒ•ã‚¡ã‚¤ãƒ«åˆ¥ã‚³ãƒ¡ãƒ³ãƒˆ\n\n> **å„ãƒ•ã‚¡ã‚¤ãƒ«ã«ã¤ã„ã¦ç°¡æ½”ã«ã‚³ãƒ¡ãƒ³ãƒˆ**ã—ã¦ãã ã•ã„ï¼ˆ1ã€œ2è¡Œã§OKï¼‰\n\
            > å•é¡ŒãŒãªã‘ã‚Œã°ã€Œâœ… å•é¡Œãªã—ã€ã¨è¨˜è¼‰\n\n| ãƒ•ã‚¡ã‚¤ãƒ« | ã‚³ãƒ¡ãƒ³ãƒˆ |\n|---------|---------|\n| `example.py`\
            \ | âœ… é©åˆ‡ãªå®Ÿè£… |\n| `config.yml` | âš ï¸ ç’°å¢ƒå¤‰æ•°ã®ä½¿ç”¨ã‚’æ¨å¥¨ |\n\n---\n\n### âœ… è‰¯ã‹ã£ãŸç‚¹\n\
            \n> ç©æ¥µçš„ã«è©•ä¾¡ã§ãã‚‹ç‚¹ã‚’å…·ä½“çš„ã«\n\n---\n\n### \U0001F4A1 ãã®ä»–ã®ã‚³ãƒ¡ãƒ³ãƒˆ\n\n> ãƒ¬ãƒ“ãƒ¥ã‚¢ãƒ¼ã¨ã—ã¦ä¼ãˆãŸã„ã“ã¨ï¼ˆä»»æ„ï¼‰"
        - id: 9699f50a-1e7e-44f5-bd2b-4a7994837ea5
          role: user
          text: 'ä»¥ä¸‹ã®Pull Requestã®ã‚³ãƒ¼ãƒ‰ãƒ¬ãƒ“ãƒ¥ãƒ¼ã‚’ãŠé¡˜ã„ã—ã¾ã™ã€‚

            æç¤ºã•ã‚ŒãŸå…¨ã¦ã®ãƒ•ã‚¡ã‚¤ãƒ«ã«ã¤ã„ã¦ã‚³ãƒ¡ãƒ³ãƒˆã—ã¦ãã ã•ã„ã€‚


            {{#1765865834591.result#}}


            ---

            **ãƒ¬ãƒ“ãƒ¥ãƒ¼å¯¾è±¡ãƒ•ã‚¡ã‚¤ãƒ«æ•°**: {{#1765865834591.file_count#}}ä»¶

            **è©³ç´°è¡¨ç¤º**: {{#1765865834591.detailed_file_count#}}ä»¶

            **ã‚µãƒãƒªãƒ¼è¡¨ç¤º**: {{#1765865834591.summary_file_count#}}ä»¶'
        selected: true
        title: AIã‚³ãƒ¼ãƒ‰ãƒ¬ãƒ“ãƒ¥ãƒ¼
        type: llm
        vision:
          enabled: false
      height: 130
      id: '1765866652109'
      position:
        x: 1706
        y: 93
      positionAbsolute:
        x: 1706
        y: 93
      selected: true
      sourcePosition: right
      targetPosition: left
      type: custom
      width: 241
    - data:
        outputs:
        - value_selector:
          - '1765866652109'
          - text
          value_type: string
          variable: review_result
        - value_selector:
          - '1765865834591'
          - file_count
          value_type: string
          variable: file_count
        - value_selector:
          - '1765865834591'
          - detailed_file_count
          value_type: string
          variable: detailed_file_count
        - value_selector:
          - '1765865834591'
          - summary_file_count
          value_type: string
          variable: summary_file_count
        - value_selector:
          - '1765865834591'
          - truncated_file_count
          value_type: string
          variable: truncated_file_count
        - value_selector:
          - '1765865834591'
          - total_additions
          value_type: string
          variable: total_additions
        - value_selector:
          - '1765865834591'
          - total_deletions
          value_type: string
          variable: total_deletions
        selected: false
        title: çµ‚äº†
        type: end
      height: 243
      id: '1765866969379'
      position:
        x: 2047
        y: 36
      positionAbsolute:
        x: 2047
        y: 36
      selected: true
      sourcePosition: right
      targetPosition: left
      type: custom
      width: 241
    viewport:
      x: 66.86111389390294
      y: 123.16666705782205
      zoom: 0.48611111111111116
  rag_pipeline_variables: []
